<% content_for :title, "Home" %>
<div class="slider">
    <ul class="slides">
      <li>
        <img src="http://lorempixel.com/580/250/nature/1"> <!-- random image -->
        <div class="caption center-align">
          <h3>This is our big Tagline!</h3>
          <h5 class="light grey-text text-lighten-3">Here's our small slogan.</h5>
        </div>
      </li>
      <li>
        <img src="http://lorempixel.com/580/250/nature/2"> <!-- random image -->
        <div class="caption left-align">
          <h3>Left Aligned Caption</h3>
          <h5 class="light grey-text text-lighten-3">Here's our small slogan.</h5>
        </div>
      </li>
      <li>
        <img src="http://lorempixel.com/580/250/nature/3"> <!-- random image -->
        <div class="caption right-align">
          <h3>Right Aligned Caption</h3>
          <h5 class="light grey-text text-lighten-3">Here's our small slogan.</h5>
        </div>
      </li>
      <li>
        <img src="http://lorempixel.com/580/250/nature/4"> <!-- random image -->
        <div class="caption center-align">
          <h3>This is our big Tagline!</h3>
          <h5 class="light grey-text text-lighten-3">Here's our small slogan.</h5>
        </div>
      </li>
    </ul>
  </div>
<div class="container" style="margin-top: 70px;">
	<h4>Upcoming events</h4>
	<div class="divider row"></div>
</div>
<div  class="grey lighten-4">
	<% @categories.each_with_index do |category, index| %>
		<% if category[:events].size > 0 %>
		<div  style="background-image: url('<%= category[:photo] %>'); background-size: cover; background-attachment: fixed; height: 350px; width: 100%;">
			<div class="container">
				<h1 style="font-size: 15rem; line-height: 350px; margin-top: 0; color: rgba(0,0,0,0.5);"><%= category[:name] %></h1>
			</div>
		</div>
		<div class="container">
			<div class="section">
				<div class="card" style="background: rgba(255,255,255,0.97);">
					<div class="row" style="margin-bottom: 0; border-right: 1px solid #ccc; border-left: 1px solid #ccc;">
						<div class="col s12 l6" style="padding-left: 0px; padding-right: 0px;">
							<ul id="<%= category[:name] %>-event-list" style="margin: 0; border-right: 1px solid #ccc; height: 450px;">
								<% category[:events].each_with_index do |event, event_index| %>
									<li class="<% if event_index == 0 %> active <% end %>row <%= category[:name] %>-event" style="padding-top: 20px;" data-category-index="<%= index %>">
										<div class="col l4">
											<div style="width: 100px; height: 100px; position: relative; left: 50%; transform: translateX(-50%); background-image: url('<%= event[:photo] %>'); background-size: cover;"></div>
										</div>
										<div class="col l8">
											<span style="font-size: 1.2rem;" class="<%= category[:name] %>-event-item <% if event_index == 0 %> blue-text text-lighten-1 <% end %>"><%= event[:title] %></span>
										</div>
									</li>
									<li class="divider" style="<% if event_index != category[:events].size - 1 %> margin: 20px 0px; <% end %>"></li>
								<% end %>
								<li class="right-align">
									<a href="#" class="waves-effect btn-flat teal-text" style="width: 100%; height: 100%; margin: 0;">
										See more events
										<i class="mdi-navigation-arrow-forward right"></i>
									</a>
								</li>
							</ul>
						</div>
						<div class="col s12 l6">
							<div id="active-event" class="section" style="padding-left: 20px; padding-right: 20px;">
								<h3 id="<%= category[:name] %>-feature-title" style="margin: 0;"><%= category[:events].first[:title] %></h3>
								<p style="margin: 0; font-size: 1.2rem;" class="grey-text text-darken-2">by <span id="<%= category[:name] %>-feature-author"><%= category[:events].first[:author] %></span></p>
								<p id="<%= category[:name] %>-feature-description">
									<%= category[:events].first[:description] %>
								</p>
								<a id="<%= category[:name] %>-feature-link" href="<%= category[:events].first[:link] %>" class="blue-text right" target="_blank">Know more</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<% end %>
	<% end %>
</div>
<script>
	var categories = <%= @categories_json %>
	$(document).ready(function(){
		$(".slider").slider();
					console.log(categories.length);
		for(var i = 0; i < categories.length; i++){
			if(categories[i].events.length > 0){
				$("." + categories[i].name + "-event").hover(function(){
					var categoryIndex = $(this).attr("data-category-index");
					var category = categories[categoryIndex].name;
					var index = $("#" + category + "-event-list li." + category + "-event").index($(this));
					if(!$(this).hasClass("active")){
						$("#" + category+ "-event-list li." + category + "-event").removeClass("active");
						$("#"+ category + "-event-list li ." + category + "-event-item").removeClass("blue-text text-lighten-1");
						$("#" + category + "-event-list li ." + category + "-event-item:eq(" + index + ")").addClass("blue-text text-lighten-1");
						currentEvent = categories[categoryIndex].events[index];
						$("#active-event").fadeOut(200, function(){
							$("#" + categories[categoryIndex].name + "-feature-title").text(currentEvent.title);
							$("#" + categories[categoryIndex].name + "-feature-author").text(currentEvent.author);
							$("#" + categories[categoryIndex].name + "-feature-description").text(currentEvent.description);
							$("#" + categories[categoryIndex].name + "-feature-link").attr("href", currentEvent.link);
							$("#active-event").fadeIn(200);
						});
						$(this).addClass("active");
					}
				});
			}
		}
	});
</script>